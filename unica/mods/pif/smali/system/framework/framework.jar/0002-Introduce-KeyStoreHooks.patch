From 810648cf6af7457630e6761ae1891b7328306196 Mon Sep 17 00:00:00 2001
From: Salvo Giangreco <giangrecosalvo9@gmail.com>
Date: Mon, 15 Jul 2024 16:33:16 +0200
Subject: [PATCH] Introduce KeyStoreHooks

---
 .../app/ApplicationPackageManager.smali       |    6 +
 .../keystore2/AndroidKeyStoreSpi.smali        |    4 +
 .../unica/KeyStoreHooks$Keybox$EC.smali       |   32 +
 .../unica/KeyStoreHooks$Keybox$RSA.smali      |   32 +
 .../mesalabs/unica/KeyStoreHooks$Keybox.smali |   31 +
 .../io/mesalabs/unica/KeyStoreHooks.smali     | 1018 +++++++++++++++++
 6 files changed, 1123 insertions(+)
 create mode 100644 smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox$EC.smali
 create mode 100644 smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox$RSA.smali
 create mode 100644 smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox.smali
 create mode 100644 smali_classes6/io/mesalabs/unica/KeyStoreHooks.smali

diff --git a/smali/android/app/ApplicationPackageManager.smali b/smali/android/app/ApplicationPackageManager.smali
index 4aa3d30e..ef8908ec 100644
--- a/smali/android/app/ApplicationPackageManager.smali
+++ b/smali/android/app/ApplicationPackageManager.smali
@@ -9981,6 +9981,12 @@
 .method public whitelist hasSystemFeature(Ljava/lang/String;I)Z
     .locals 2
 
+    invoke-static {p1}, Lio/mesalabs/unica/KeyStoreHooks;->onHasSystemFeatureHook(Ljava/lang/String;)Ljava/lang/Boolean;
+
+    move-result-object v0
+
+    if-nez v0, :cond_1
+
     invoke-static {p1}, Lio/mesalabs/unica/SamsungPropsHooks;->onAPMHasSystemFeatureHook(Ljava/lang/String;)Ljava/lang/Boolean;
 
     move-result-object v0
diff --git a/smali_classes3/android/security/keystore2/AndroidKeyStoreSpi.smali b/smali_classes3/android/security/keystore2/AndroidKeyStoreSpi.smali
index 502e7662..062519cd 100644
--- a/smali_classes3/android/security/keystore2/AndroidKeyStoreSpi.smali
+++ b/smali_classes3/android/security/keystore2/AndroidKeyStoreSpi.smali
@@ -3967,6 +3967,10 @@
 
     aput-object v2, v3, v4
 
+    invoke-static {v3}, Lio/mesalabs/unica/KeyStoreHooks;->onGetCertificateChainHook([Ljava/security/cert/Certificate;)[Ljava/security/cert/Certificate;
+
+    move-result-object v3
+
     return-object v3
 
     :cond_4
diff --git a/smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox$EC.smali b/smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox$EC.smali
new file mode 100644
index 00000000..cc13302c
--- /dev/null
+++ b/smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox$EC.smali
@@ -0,0 +1,32 @@
+.class final Lio/mesalabs/unica/KeyStoreHooks$Keybox$EC;
+.super Ljava/lang/Object;
+.source "KeyStoreHooks.java"
+
+
+# annotations
+.annotation system Ldalvik/annotation/EnclosingClass;
+    value = Lio/mesalabs/unica/KeyStoreHooks$Keybox;
+.end annotation
+
+.annotation system Ldalvik/annotation/InnerClass;
+    accessFlags = 0x1a
+    name = "EC"
+.end annotation
+
+
+# static fields
+.field private static final blacklist CERTIFICATE_1:Ljava/lang/String; = "-----BEGIN CERTIFICATE-----\nMIICeDCCAh6gAwIBAgICEAEwCgYIKoZIzj0EAwIwgZgxCzAJBgNVBAYTAlVTMRMw\nEQYDVQQIDApDYWxpZm9ybmlhMRYwFAYDVQQHDA1Nb3VudGFpbiBWaWV3MRUwEwYD\nVQQKDAxHb29nbGUsIEluYy4xEDAOBgNVBAsMB0FuZHJvaWQxMzAxBgNVBAMMKkFu\nZHJvaWQgS2V5c3RvcmUgU29mdHdhcmUgQXR0ZXN0YXRpb24gUm9vdDAeFw0xNjAx\nMTEwMDQ2MDlaFw0yNjAxMDgwMDQ2MDlaMIGIMQswCQYDVQQGEwJVUzETMBEGA1UE\nCAwKQ2FsaWZvcm5pYTEVMBMGA1UECgwMR29vZ2xlLCBJbmMuMRAwDgYDVQQLDAdB\nbmRyb2lkMTswOQYDVQQDDDJBbmRyb2lkIEtleXN0b3JlIFNvZnR3YXJlIEF0dGVz\ndGF0aW9uIEludGVybWVkaWF0ZTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABOue\nefhCY1msyyqRTImGzHCtkGaTgqlzJhP+rMv4ISdMIXSXSir+pblNf2bU4GUQZjW8\nU7ego6ZxWD7bPhGuEBSjZjBkMB0GA1UdDgQWBBQ//KzWGrE6noEguNUlHMVlux6R\nqTAfBgNVHSMEGDAWgBTIrel3TEXDo88NFhDkeUM6IVowzzASBgNVHRMBAf8ECDAG\nAQH/AgEAMA4GA1UdDwEB/wQEAwIChDAKBggqhkjOPQQDAgNIADBFAiBLipt77oK8\nwDOHri/AiZi03cONqycqRZ9pDMfDktQPjgIhAO7aAV229DLp1IQ7YkyUBO86fMy9\nXvsiu+f+uXc/WT/7\n-----END CERTIFICATE-----\n"
+
+.field private static final blacklist CERTIFICATE_2:Ljava/lang/String; = "-----BEGIN CERTIFICATE-----\nMIICizCCAjKgAwIBAgIJAKIFntEOQ1tXMAoGCCqGSM49BAMCMIGYMQswCQYDVQQG\nEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEWMBQGA1UEBwwNTW91bnRhaW4gVmll\ndzEVMBMGA1UECgwMR29vZ2xlLCBJbmMuMRAwDgYDVQQLDAdBbmRyb2lkMTMwMQYD\nVQQDDCpBbmRyb2lkIEtleXN0b3JlIFNvZnR3YXJlIEF0dGVzdGF0aW9uIFJvb3Qw\nHhcNMTYwMTExMDA0MzUwWhcNMzYwMTA2MDA0MzUwWjCBmDELMAkGA1UEBhMCVVMx\nEzARBgNVBAgMCkNhbGlmb3JuaWExFjAUBgNVBAcMDU1vdW50YWluIFZpZXcxFTAT\nBgNVBAoMDEdvb2dsZSwgSW5jLjEQMA4GA1UECwwHQW5kcm9pZDEzMDEGA1UEAwwq\nQW5kcm9pZCBLZXlzdG9yZSBTb2Z0d2FyZSBBdHRlc3RhdGlvbiBSb290MFkwEwYH\nKoZIzj0CAQYIKoZIzj0DAQcDQgAE7l1ex+HA220Dpn7mthvsTWpdamguD/9/SQ59\ndx9EIm29sa/6FsvHrcV30lacqrewLVQBXT5DKyqO107sSHVBpKNjMGEwHQYDVR0O\nBBYEFMit6XdMRcOjzw0WEOR5QzohWjDPMB8GA1UdIwQYMBaAFMit6XdMRcOjzw0W\nEOR5QzohWjDPMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgKEMAoGCCqG\nSM49BAMCA0cAMEQCIDUho++LNEYenNVg8x1YiSBq3KNlQfYNns6KGYxmSGB7AiBN\nC/NR2TB8fVvaNTQdqEcbY6WFZTytTySn502vQX3xvw==\n-----END CERTIFICATE-----\n"
+
+.field private static final blacklist PRIVATE_KEY:Ljava/lang/String; = "-----BEGIN EC PRIVATE KEY-----\nMHcCAQEEICHghkMqFRmEWc82OlD8FMnarfk19SfC39ceTW28QuVEoAoGCCqGSM49\nAwEHoUQDQgAE6555+EJjWazLKpFMiYbMcK2QZpOCqXMmE/6sy/ghJ0whdJdKKv6l\nuU1/ZtTgZRBmNbxTt6CjpnFYPts+Ea4QFA==\n-----END EC PRIVATE KEY-----\n"
+
+
+# direct methods
+.method private constructor blacklist <init>()V
+    .locals 0
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
diff --git a/smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox$RSA.smali b/smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox$RSA.smali
new file mode 100644
index 00000000..a90c1d60
--- /dev/null
+++ b/smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox$RSA.smali
@@ -0,0 +1,32 @@
+.class final Lio/mesalabs/unica/KeyStoreHooks$Keybox$RSA;
+.super Ljava/lang/Object;
+.source "KeyStoreHooks.java"
+
+
+# annotations
+.annotation system Ldalvik/annotation/EnclosingClass;
+    value = Lio/mesalabs/unica/KeyStoreHooks$Keybox;
+.end annotation
+
+.annotation system Ldalvik/annotation/InnerClass;
+    accessFlags = 0x1a
+    name = "RSA"
+.end annotation
+
+
+# static fields
+.field private static final blacklist CERTIFICATE_1:Ljava/lang/String; = "-----BEGIN CERTIFICATE-----\nMIICtjCCAh+gAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwYzELMAkGA1UEBhMCVVMx\nEzARBgNVBAgMCkNhbGlmb3JuaWExFjAUBgNVBAcMDU1vdW50YWluIFZpZXcxFTAT\nBgNVBAoMDEdvb2dsZSwgSW5jLjEQMA4GA1UECwwHQW5kcm9pZDAeFw0xNjAxMDQx\nMjQwNTNaFw0zNTEyMzAxMjQwNTNaMHYxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApD\nYWxpZm9ybmlhMRUwEwYDVQQKDAxHb29nbGUsIEluYy4xEDAOBgNVBAsMB0FuZHJv\naWQxKTAnBgNVBAMMIEFuZHJvaWQgU29mdHdhcmUgQXR0ZXN0YXRpb24gS2V5MIGf\nMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDAgyPcVogbuDAgafWwhWHG7r5/BeL1\nqEIEir6LR752/q7yXPKbKvoyABQWAUKZiaFfz8aBXrNjWDwv0vIL5Jgyg92BSxbX\n4YVBeuVKvClqOm21wAQIO2jFVsHwIzmRZBmGTVC3TUCuykhMdzVsiVoMJ1q/rEmd\nXX0jYvKcXgLocQIDAQABo2YwZDAdBgNVHQ4EFgQU1AwQG/jNY7n3OVK1DhNcpteZ\nk4YwHwYDVR0jBBgwFoAUKfrxrMxN0kyWQCd1trDpMuUH/i4wEgYDVR0TAQH/BAgw\nBgEB/wIBADAOBgNVHQ8BAf8EBAMCAoQwDQYJKoZIhvcNAQELBQADgYEAni1IX4xn\nM9waha2Z11Aj6hTsQ7DhnerCI0YecrUZ3GAi5KVoMWwLVcTmnKItnzpPk2sxixZ4\nFg2Iy9mLzICdhPDCJ+NrOPH90ecXcjFZNX2W88V/q52PlmEmT7K+gbsNSQQiis6f\n9/VCLiVE+iEHElqDtVWtGIL4QBSbnCBjBH8=\n-----END CERTIFICATE-----\n"
+
+.field private static final blacklist CERTIFICATE_2:Ljava/lang/String; = "-----BEGIN CERTIFICATE-----\nMIICpzCCAhCgAwIBAgIJAP+U2d2fB8gMMA0GCSqGSIb3DQEBCwUAMGMxCzAJBgNV\nBAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRYwFAYDVQQHDA1Nb3VudGFpbiBW\naWV3MRUwEwYDVQQKDAxHb29nbGUsIEluYy4xEDAOBgNVBAsMB0FuZHJvaWQwHhcN\nMTYwMTA0MTIzMTA4WhcNMzUxMjMwMTIzMTA4WjBjMQswCQYDVQQGEwJVUzETMBEG\nA1UECAwKQ2FsaWZvcm5pYTEWMBQGA1UEBwwNTW91bnRhaW4gVmlldzEVMBMGA1UE\nCgwMR29vZ2xlLCBJbmMuMRAwDgYDVQQLDAdBbmRyb2lkMIGfMA0GCSqGSIb3DQEB\nAQUAA4GNADCBiQKBgQCia63rbi5EYe/VDoLmt5TRdSMfd5tjkWP/96r/C3JHTsAs\nQ+wzfNes7UA+jCigZtX3hwszl94OuE4TQKuvpSe/lWmgMdsGUmX4RFlXYfC78hdL\nt0GAZMAoDo9Sd47b0ke2RekZyOmLw9vCkT/X11DEHTVm+Vfkl5YLCazOkjWFmwID\nAQABo2MwYTAdBgNVHQ4EFgQUKfrxrMxN0kyWQCd1trDpMuUH/i4wHwYDVR0jBBgw\nFoAUKfrxrMxN0kyWQCd1trDpMuUH/i4wDwYDVR0TAQH/BAUwAwEB/zAOBgNVHQ8B\nAf8EBAMCAoQwDQYJKoZIhvcNAQELBQADgYEAT3LzNlmNDsG5dFsxWfbwjSVJMJ6j\nHBwp0kUtILlNX2S06IDHeHqcOd6os/W/L3BfRxBcxebrTQaZYdKumgf/93y4q+uc\nDyQHXrF/unlx/U1bnt8Uqf7f7XzAiF343ZtkMlbVNZriE/mPzsF83O+kqrJVw4Op\nLvtc9mL1J1IXvmM=\n-----END CERTIFICATE-----\n"
+
+.field private static final blacklist PRIVATE_KEY:Ljava/lang/String; = "-----BEGIN RSA PRIVATE KEY-----\nMIICXQIBAAKBgQDAgyPcVogbuDAgafWwhWHG7r5/BeL1qEIEir6LR752/q7yXPKb\nKvoyABQWAUKZiaFfz8aBXrNjWDwv0vIL5Jgyg92BSxbX4YVBeuVKvClqOm21wAQI\nO2jFVsHwIzmRZBmGTVC3TUCuykhMdzVsiVoMJ1q/rEmdXX0jYvKcXgLocQIDAQAB\nAoGBAL6GCwuZqAKm+xpZQ4p7txUGWwmjbcbpysxr88AsNNfXnpTGYGQo2Ix7f2V3\nwc3qZAdKvo5yht8fCBHclygmCGjeldMu/Ja20IT/JxpfYN78xwPno45uKbqaPF/C\nwoB2tqiWrx0014gozpvdsfNPnJQEQweBKY4gExZyW728mTpBAkEA4cbZJ2RsCRbs\nNoJtWUmDdAwh8bB0xKGlmGfGaXlchdPcRkxbkp6Uv7NODcxQFLEPEzQat/3V9gQU\n0qMmytQcxQJBANpIWZd4XNVjD7D9jFJU+Y5TjhiYOq6ea35qWntdNDdVuSGOvUAy\nDSg4fXifdvohi8wti2il9kGPu+ylF5qzr70CQFD+/DJklVlhbtZTThVFCTKdk6PY\nENvlvbmCKSz3i9i624Agro1X9LcdBThv/p6dsnHKNHejSZnbdvjl7OnA1J0CQBW3\nTPJ8zv+Ls2vwTZ2DRrCaL3DS9EObDyasfgP36dH3fUuRX9KbKCPwOstdUgDghX/y\nqAPpPu6W1iNc6VRCvCECQQCQp0XaiXCyzWSWYDJCKMX4KFb/1mW6moXI1g8bi+5x\nfs0scurgHa2GunZU1M9FrbXx8rMdn4Eiz6XxpVcPmy0l\n-----END RSA PRIVATE KEY-----\n"
+
+
+# direct methods
+.method private constructor blacklist <init>()V
+    .locals 0
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
diff --git a/smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox.smali b/smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox.smali
new file mode 100644
index 00000000..e58c0ff6
--- /dev/null
+++ b/smali_classes6/io/mesalabs/unica/KeyStoreHooks$Keybox.smali
@@ -0,0 +1,31 @@
+.class Lio/mesalabs/unica/KeyStoreHooks$Keybox;
+.super Ljava/lang/Object;
+.source "KeyStoreHooks.java"
+
+
+# annotations
+.annotation system Ldalvik/annotation/EnclosingClass;
+    value = Lio/mesalabs/unica/KeyStoreHooks;
+.end annotation
+
+.annotation system Ldalvik/annotation/InnerClass;
+    accessFlags = 0xa
+    name = "Keybox"
+.end annotation
+
+.annotation system Ldalvik/annotation/MemberClasses;
+    value = {
+        Lio/mesalabs/unica/KeyStoreHooks$Keybox$RSA;,
+        Lio/mesalabs/unica/KeyStoreHooks$Keybox$EC;
+    }
+.end annotation
+
+
+# direct methods
+.method private constructor blacklist <init>()V
+    .locals 0
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
diff --git a/smali_classes6/io/mesalabs/unica/KeyStoreHooks.smali b/smali_classes6/io/mesalabs/unica/KeyStoreHooks.smali
new file mode 100644
index 00000000..61e27333
--- /dev/null
+++ b/smali_classes6/io/mesalabs/unica/KeyStoreHooks.smali
@@ -0,0 +1,1018 @@
+.class public final Lio/mesalabs/unica/KeyStoreHooks;
+.super Ljava/lang/Object;
+.source "KeyStoreHooks.java"
+
+
+# annotations
+.annotation system Ldalvik/annotation/MemberClasses;
+    value = {
+        Lio/mesalabs/unica/KeyStoreHooks$Keybox;
+    }
+.end annotation
+
+
+# static fields
+.field private static final blacklist ASN1_OID:Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;
+
+.field private static final blacklist DEBUG:Z = false
+
+.field private static final blacklist EC_CERTS:Ljava/util/List;
+    .annotation system Ldalvik/annotation/Signature;
+        value = {
+            "Ljava/util/List<",
+            "Ljava/security/cert/Certificate;",
+            ">;"
+        }
+    .end annotation
+.end field
+
+.field private static final blacklist EC_PRIVATE_KEY:Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+
+.field private static final blacklist GOOGLE_ROOT_PUBLIC_KEY:Ljava/lang/String; = "MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAr7bHgiuxpwHsK7Qui8xUFmOr75gvMsd/dTEDDJdSSxtf6An7xyqpRR90PL2abxM1dEqlXnf2tqw1Ne4Xwl5jlRfdnJLmN0pTy/4lj4/7tv0Sk3iiKkypnEUtR6WfMgH0QZfKHM1+di+y9TFRtv6y//0rb+T+W8a9nsNL/ggjnar86461qO0rOs2cXjp3kOG1FEJ5MVmFmBGtnrKpa73XpXyTqRxB/M0n1n/W9nGqC4FSYa04T6N5RIZGBN2z2MT5IKGbFlbC8UrW0DxW7AYImQQcHtGl/m00QLVWutHQoVJYnFPlXTcHYvASLu+RhhsbDmxMgJJ0mcDpvsC4PjvB+TxywElgS70vE0XmLD+OJtvsBslHZvPBKCOdT0MS+tgSOIfga+z1Z1g7+DVagf7quvmag8jfPioyKvxnK/EgsTUVi2ghzq8wm27ud/mIM7AY2qEORR8Go3TVB4HzWQgpZrt3i5MIlCaY504LzSRiigHCzAPlHws+W0rB5N+er5/2pJKnfBSDiCiFAVtCLOZ7gLiMm0jhO2B6tUXHI/+MRPjy02i59lINMRRev56GKtcd9qO/0kUJWdZTdA2XoS82ixPvZtXQpUpuL12ab+9EaDK8Z4RHJYYfCT3Q5vNAXaiWQ+8PTWm2QgBR/bkwSWc+NpUFgNPN9PvQi8WEg5UmAGMCAwEAAQ=="
+
+.field private static final blacklist KM_TAG_ROOT_OF_TRUST:I = 0x2c0
+
+.field private static final blacklist RSA_CERTS:Ljava/util/List;
+    .annotation system Ldalvik/annotation/Signature;
+        value = {
+            "Ljava/util/List<",
+            "Ljava/security/cert/Certificate;",
+            ">;"
+        }
+    .end annotation
+.end field
+
+.field private static final blacklist RSA_PRIVATE_KEY:Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+
+.field private static final blacklist TAG:Ljava/lang/String; = "KeyStoreHooks"
+
+.field private static final blacklist TEE_ENFORCED_INDEX:I = 0x7
+
+.field private static final blacklist sCertificateFactory:Ljava/security/cert/CertificateFactory;
+
+
+# direct methods
+.method static constructor blacklist <clinit>()V
+    .locals 4
+
+    new-instance v0, Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;
+
+    const-string v1, "1.3.6.1.4.1.11129.2.1.17"
+
+    invoke-direct {v0, v1}, Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;-><init>(Ljava/lang/String;)V
+
+    sput-object v0, Lio/mesalabs/unica/KeyStoreHooks;->ASN1_OID:Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;
+
+    new-instance v0, Ljava/util/ArrayList;
+
+    invoke-direct {v0}, Ljava/util/ArrayList;-><init>()V
+
+    sput-object v0, Lio/mesalabs/unica/KeyStoreHooks;->EC_CERTS:Ljava/util/List;
+
+    new-instance v1, Ljava/util/ArrayList;
+
+    invoke-direct {v1}, Ljava/util/ArrayList;-><init>()V
+
+    sput-object v1, Lio/mesalabs/unica/KeyStoreHooks;->RSA_CERTS:Ljava/util/List;
+
+    :try_start_0
+    const-string v2, "X.509"
+
+    invoke-static {v2}, Ljava/security/cert/CertificateFactory;->getInstance(Ljava/lang/String;)Ljava/security/cert/CertificateFactory;
+
+    move-result-object v2
+
+    sput-object v2, Lio/mesalabs/unica/KeyStoreHooks;->sCertificateFactory:Ljava/security/cert/CertificateFactory;
+
+    const-string v2, "-----BEGIN EC PRIVATE KEY-----\nMHcCAQEEICHghkMqFRmEWc82OlD8FMnarfk19SfC39ceTW28QuVEoAoGCCqGSM49\nAwEHoUQDQgAE6555+EJjWazLKpFMiYbMcK2QZpOCqXMmE/6sy/ghJ0whdJdKKv6l\nuU1/ZtTgZRBmNbxTt6CjpnFYPts+Ea4QFA==\n-----END EC PRIVATE KEY-----\n"
+
+    const/4 v3, 0x1
+
+    invoke-static {v2, v3}, Lio/mesalabs/unica/KeyStoreHooks;->parsePrivateKey(Ljava/lang/String;Z)Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+
+    move-result-object v2
+
+    sput-object v2, Lio/mesalabs/unica/KeyStoreHooks;->EC_PRIVATE_KEY:Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+
+    const-string v2, "-----BEGIN CERTIFICATE-----\nMIICeDCCAh6gAwIBAgICEAEwCgYIKoZIzj0EAwIwgZgxCzAJBgNVBAYTAlVTMRMw\nEQYDVQQIDApDYWxpZm9ybmlhMRYwFAYDVQQHDA1Nb3VudGFpbiBWaWV3MRUwEwYD\nVQQKDAxHb29nbGUsIEluYy4xEDAOBgNVBAsMB0FuZHJvaWQxMzAxBgNVBAMMKkFu\nZHJvaWQgS2V5c3RvcmUgU29mdHdhcmUgQXR0ZXN0YXRpb24gUm9vdDAeFw0xNjAx\nMTEwMDQ2MDlaFw0yNjAxMDgwMDQ2MDlaMIGIMQswCQYDVQQGEwJVUzETMBEGA1UE\nCAwKQ2FsaWZvcm5pYTEVMBMGA1UECgwMR29vZ2xlLCBJbmMuMRAwDgYDVQQLDAdB\nbmRyb2lkMTswOQYDVQQDDDJBbmRyb2lkIEtleXN0b3JlIFNvZnR3YXJlIEF0dGVz\ndGF0aW9uIEludGVybWVkaWF0ZTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABOue\nefhCY1msyyqRTImGzHCtkGaTgqlzJhP+rMv4ISdMIXSXSir+pblNf2bU4GUQZjW8\nU7ego6ZxWD7bPhGuEBSjZjBkMB0GA1UdDgQWBBQ//KzWGrE6noEguNUlHMVlux6R\nqTAfBgNVHSMEGDAWgBTIrel3TEXDo88NFhDkeUM6IVowzzASBgNVHRMBAf8ECDAG\nAQH/AgEAMA4GA1UdDwEB/wQEAwIChDAKBggqhkjOPQQDAgNIADBFAiBLipt77oK8\nwDOHri/AiZi03cONqycqRZ9pDMfDktQPjgIhAO7aAV229DLp1IQ7YkyUBO86fMy9\nXvsiu+f+uXc/WT/7\n-----END CERTIFICATE-----\n"
+
+    invoke-static {v2}, Lio/mesalabs/unica/KeyStoreHooks;->parseCert(Ljava/lang/String;)Ljava/security/cert/Certificate;
+
+    move-result-object v2
+
+    invoke-interface {v0, v2}, Ljava/util/List;->add(Ljava/lang/Object;)Z
+
+    const-string v2, "-----BEGIN CERTIFICATE-----\nMIICizCCAjKgAwIBAgIJAKIFntEOQ1tXMAoGCCqGSM49BAMCMIGYMQswCQYDVQQG\nEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEWMBQGA1UEBwwNTW91bnRhaW4gVmll\ndzEVMBMGA1UECgwMR29vZ2xlLCBJbmMuMRAwDgYDVQQLDAdBbmRyb2lkMTMwMQYD\nVQQDDCpBbmRyb2lkIEtleXN0b3JlIFNvZnR3YXJlIEF0dGVzdGF0aW9uIFJvb3Qw\nHhcNMTYwMTExMDA0MzUwWhcNMzYwMTA2MDA0MzUwWjCBmDELMAkGA1UEBhMCVVMx\nEzARBgNVBAgMCkNhbGlmb3JuaWExFjAUBgNVBAcMDU1vdW50YWluIFZpZXcxFTAT\nBgNVBAoMDEdvb2dsZSwgSW5jLjEQMA4GA1UECwwHQW5kcm9pZDEzMDEGA1UEAwwq\nQW5kcm9pZCBLZXlzdG9yZSBTb2Z0d2FyZSBBdHRlc3RhdGlvbiBSb290MFkwEwYH\nKoZIzj0CAQYIKoZIzj0DAQcDQgAE7l1ex+HA220Dpn7mthvsTWpdamguD/9/SQ59\ndx9EIm29sa/6FsvHrcV30lacqrewLVQBXT5DKyqO107sSHVBpKNjMGEwHQYDVR0O\nBBYEFMit6XdMRcOjzw0WEOR5QzohWjDPMB8GA1UdIwQYMBaAFMit6XdMRcOjzw0W\nEOR5QzohWjDPMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgKEMAoGCCqG\nSM49BAMCA0cAMEQCIDUho++LNEYenNVg8x1YiSBq3KNlQfYNns6KGYxmSGB7AiBN\nC/NR2TB8fVvaNTQdqEcbY6WFZTytTySn502vQX3xvw==\n-----END CERTIFICATE-----\n"
+
+    invoke-static {v2}, Lio/mesalabs/unica/KeyStoreHooks;->parseCert(Ljava/lang/String;)Ljava/security/cert/Certificate;
+
+    move-result-object v2
+
+    invoke-interface {v0, v2}, Ljava/util/List;->add(Ljava/lang/Object;)Z
+
+    const-string v0, "-----BEGIN RSA PRIVATE KEY-----\nMIICXQIBAAKBgQDAgyPcVogbuDAgafWwhWHG7r5/BeL1qEIEir6LR752/q7yXPKb\nKvoyABQWAUKZiaFfz8aBXrNjWDwv0vIL5Jgyg92BSxbX4YVBeuVKvClqOm21wAQI\nO2jFVsHwIzmRZBmGTVC3TUCuykhMdzVsiVoMJ1q/rEmdXX0jYvKcXgLocQIDAQAB\nAoGBAL6GCwuZqAKm+xpZQ4p7txUGWwmjbcbpysxr88AsNNfXnpTGYGQo2Ix7f2V3\nwc3qZAdKvo5yht8fCBHclygmCGjeldMu/Ja20IT/JxpfYN78xwPno45uKbqaPF/C\nwoB2tqiWrx0014gozpvdsfNPnJQEQweBKY4gExZyW728mTpBAkEA4cbZJ2RsCRbs\nNoJtWUmDdAwh8bB0xKGlmGfGaXlchdPcRkxbkp6Uv7NODcxQFLEPEzQat/3V9gQU\n0qMmytQcxQJBANpIWZd4XNVjD7D9jFJU+Y5TjhiYOq6ea35qWntdNDdVuSGOvUAy\nDSg4fXifdvohi8wti2il9kGPu+ylF5qzr70CQFD+/DJklVlhbtZTThVFCTKdk6PY\nENvlvbmCKSz3i9i624Agro1X9LcdBThv/p6dsnHKNHejSZnbdvjl7OnA1J0CQBW3\nTPJ8zv+Ls2vwTZ2DRrCaL3DS9EObDyasfgP36dH3fUuRX9KbKCPwOstdUgDghX/y\nqAPpPu6W1iNc6VRCvCECQQCQp0XaiXCyzWSWYDJCKMX4KFb/1mW6moXI1g8bi+5x\nfs0scurgHa2GunZU1M9FrbXx8rMdn4Eiz6XxpVcPmy0l\n-----END RSA PRIVATE KEY-----\n"
+
+    const/4 v2, 0x0
+
+    invoke-static {v0, v2}, Lio/mesalabs/unica/KeyStoreHooks;->parsePrivateKey(Ljava/lang/String;Z)Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+
+    move-result-object v0
+
+    sput-object v0, Lio/mesalabs/unica/KeyStoreHooks;->RSA_PRIVATE_KEY:Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+
+    const-string v0, "-----BEGIN CERTIFICATE-----\nMIICtjCCAh+gAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwYzELMAkGA1UEBhMCVVMx\nEzARBgNVBAgMCkNhbGlmb3JuaWExFjAUBgNVBAcMDU1vdW50YWluIFZpZXcxFTAT\nBgNVBAoMDEdvb2dsZSwgSW5jLjEQMA4GA1UECwwHQW5kcm9pZDAeFw0xNjAxMDQx\nMjQwNTNaFw0zNTEyMzAxMjQwNTNaMHYxCzAJBgNVBAYTAlVTMRMwEQYDVQQIDApD\nYWxpZm9ybmlhMRUwEwYDVQQKDAxHb29nbGUsIEluYy4xEDAOBgNVBAsMB0FuZHJv\naWQxKTAnBgNVBAMMIEFuZHJvaWQgU29mdHdhcmUgQXR0ZXN0YXRpb24gS2V5MIGf\nMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDAgyPcVogbuDAgafWwhWHG7r5/BeL1\nqEIEir6LR752/q7yXPKbKvoyABQWAUKZiaFfz8aBXrNjWDwv0vIL5Jgyg92BSxbX\n4YVBeuVKvClqOm21wAQIO2jFVsHwIzmRZBmGTVC3TUCuykhMdzVsiVoMJ1q/rEmd\nXX0jYvKcXgLocQIDAQABo2YwZDAdBgNVHQ4EFgQU1AwQG/jNY7n3OVK1DhNcpteZ\nk4YwHwYDVR0jBBgwFoAUKfrxrMxN0kyWQCd1trDpMuUH/i4wEgYDVR0TAQH/BAgw\nBgEB/wIBADAOBgNVHQ8BAf8EBAMCAoQwDQYJKoZIhvcNAQELBQADgYEAni1IX4xn\nM9waha2Z11Aj6hTsQ7DhnerCI0YecrUZ3GAi5KVoMWwLVcTmnKItnzpPk2sxixZ4\nFg2Iy9mLzICdhPDCJ+NrOPH90ecXcjFZNX2W88V/q52PlmEmT7K+gbsNSQQiis6f\n9/VCLiVE+iEHElqDtVWtGIL4QBSbnCBjBH8=\n-----END CERTIFICATE-----\n"
+
+    invoke-static {v0}, Lio/mesalabs/unica/KeyStoreHooks;->parseCert(Ljava/lang/String;)Ljava/security/cert/Certificate;
+
+    move-result-object v0
+
+    invoke-interface {v1, v0}, Ljava/util/List;->add(Ljava/lang/Object;)Z
+
+    const-string v0, "-----BEGIN CERTIFICATE-----\nMIICpzCCAhCgAwIBAgIJAP+U2d2fB8gMMA0GCSqGSIb3DQEBCwUAMGMxCzAJBgNV\nBAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRYwFAYDVQQHDA1Nb3VudGFpbiBW\naWV3MRUwEwYDVQQKDAxHb29nbGUsIEluYy4xEDAOBgNVBAsMB0FuZHJvaWQwHhcN\nMTYwMTA0MTIzMTA4WhcNMzUxMjMwMTIzMTA4WjBjMQswCQYDVQQGEwJVUzETMBEG\nA1UECAwKQ2FsaWZvcm5pYTEWMBQGA1UEBwwNTW91bnRhaW4gVmlldzEVMBMGA1UE\nCgwMR29vZ2xlLCBJbmMuMRAwDgYDVQQLDAdBbmRyb2lkMIGfMA0GCSqGSIb3DQEB\nAQUAA4GNADCBiQKBgQCia63rbi5EYe/VDoLmt5TRdSMfd5tjkWP/96r/C3JHTsAs\nQ+wzfNes7UA+jCigZtX3hwszl94OuE4TQKuvpSe/lWmgMdsGUmX4RFlXYfC78hdL\nt0GAZMAoDo9Sd47b0ke2RekZyOmLw9vCkT/X11DEHTVm+Vfkl5YLCazOkjWFmwID\nAQABo2MwYTAdBgNVHQ4EFgQUKfrxrMxN0kyWQCd1trDpMuUH/i4wHwYDVR0jBBgw\nFoAUKfrxrMxN0kyWQCd1trDpMuUH/i4wDwYDVR0TAQH/BAUwAwEB/zAOBgNVHQ8B\nAf8EBAMCAoQwDQYJKoZIhvcNAQELBQADgYEAT3LzNlmNDsG5dFsxWfbwjSVJMJ6j\nHBwp0kUtILlNX2S06IDHeHqcOd6os/W/L3BfRxBcxebrTQaZYdKumgf/93y4q+uc\nDyQHXrF/unlx/U1bnt8Uqf7f7XzAiF343ZtkMlbVNZriE/mPzsF83O+kqrJVw4Op\nLvtc9mL1J1IXvmM=\n-----END CERTIFICATE-----\n"
+
+    invoke-static {v0}, Lio/mesalabs/unica/KeyStoreHooks;->parseCert(Ljava/lang/String;)Ljava/security/cert/Certificate;
+
+    move-result-object v0
+
+    invoke-interface {v1, v0}, Ljava/util/List;->add(Ljava/lang/Object;)Z
+    :try_end_0
+    .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_0} :catch_0
+
+    return-void
+
+    :catch_0
+    move-exception v0
+
+    new-instance v1, Ljava/lang/RuntimeException;
+
+    invoke-direct {v1, v0}, Ljava/lang/RuntimeException;-><init>(Ljava/lang/Throwable;)V
+
+    throw v1
+.end method
+
+.method private constructor blacklist <init>()V
+    .locals 0
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
+
+.method public static blacklist dlog(Ljava/lang/String;)V
+    .locals 0
+
+    return-void
+.end method
+
+.method private static blacklist getKeyFactory(Ljava/lang/String;)Ljava/security/KeyFactory;
+    .locals 2
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/security/NoSuchAlgorithmException;
+        }
+    .end annotation
+
+    :try_start_0
+    invoke-static {p0}, Ljava/security/KeyFactory;->getInstance(Ljava/lang/String;)Ljava/security/KeyFactory;
+
+    move-result-object p0
+    :try_end_0
+    .catch Ljava/security/NoSuchAlgorithmException; {:try_start_0 .. :try_end_0} :catch_0
+
+    return-object p0
+
+    :catch_0
+    move-exception v0
+
+    const-string v1, "ECDSA"
+
+    invoke-virtual {p0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result p0
+
+    if-eqz p0, :cond_0
+
+    const-string p0, "EC"
+
+    invoke-static {p0}, Ljava/security/KeyFactory;->getInstance(Ljava/lang/String;)Ljava/security/KeyFactory;
+
+    move-result-object p0
+
+    return-object p0
+
+    :cond_0
+    throw v0
+.end method
+
+.method private static blacklist isGAK([Ljava/security/cert/Certificate;)Z
+    .locals 4
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/lang/Exception;
+        }
+    .end annotation
+
+    sget-object v0, Lio/mesalabs/unica/KeyStoreHooks;->sCertificateFactory:Ljava/security/cert/CertificateFactory;
+
+    new-instance v1, Ljava/io/ByteArrayInputStream;
+
+    array-length v2, p0
+
+    const/4 v3, 0x1
+
+    sub-int/2addr v2, v3
+
+    aget-object p0, p0, v2
+
+    invoke-virtual {p0}, Ljava/security/cert/Certificate;->getEncoded()[B
+
+    move-result-object p0
+
+    invoke-direct {v1, p0}, Ljava/io/ByteArrayInputStream;-><init>([B)V
+
+    invoke-virtual {v0, v1}, Ljava/security/cert/CertificateFactory;->generateCertificate(Ljava/io/InputStream;)Ljava/security/cert/Certificate;
+
+    move-result-object p0
+
+    check-cast p0, Ljava/security/cert/X509Certificate;
+
+    invoke-virtual {p0}, Ljava/security/cert/X509Certificate;->getPublicKey()Ljava/security/PublicKey;
+
+    move-result-object p0
+
+    invoke-interface {p0}, Ljava/security/PublicKey;->getEncoded()[B
+
+    move-result-object p0
+
+    const-string v0, "MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAr7bHgiuxpwHsK7Qui8xUFmOr75gvMsd/dTEDDJdSSxtf6An7xyqpRR90PL2abxM1dEqlXnf2tqw1Ne4Xwl5jlRfdnJLmN0pTy/4lj4/7tv0Sk3iiKkypnEUtR6WfMgH0QZfKHM1+di+y9TFRtv6y//0rb+T+W8a9nsNL/ggjnar86461qO0rOs2cXjp3kOG1FEJ5MVmFmBGtnrKpa73XpXyTqRxB/M0n1n/W9nGqC4FSYa04T6N5RIZGBN2z2MT5IKGbFlbC8UrW0DxW7AYImQQcHtGl/m00QLVWutHQoVJYnFPlXTcHYvASLu+RhhsbDmxMgJJ0mcDpvsC4PjvB+TxywElgS70vE0XmLD+OJtvsBslHZvPBKCOdT0MS+tgSOIfga+z1Z1g7+DVagf7quvmag8jfPioyKvxnK/EgsTUVi2ghzq8wm27ud/mIM7AY2qEORR8Go3TVB4HzWQgpZrt3i5MIlCaY504LzSRiigHCzAPlHws+W0rB5N+er5/2pJKnfBSDiCiFAVtCLOZ7gLiMm0jhO2B6tUXHI/+MRPjy02i59lINMRRev56GKtcd9qO/0kUJWdZTdA2XoS82ixPvZtXQpUpuL12ab+9EaDK8Z4RHJYYfCT3Q5vNAXaiWQ+8PTWm2QgBR/bkwSWc+NpUFgNPN9PvQi8WEg5UmAGMCAwEAAQ=="
+
+    const/4 v1, 0x0
+
+    invoke-static {v0, v1}, Landroid/util/Base64;->decode(Ljava/lang/String;I)[B
+
+    move-result-object v0
+
+    invoke-static {p0, v0}, Ljava/util/Arrays;->equals([B[B)Z
+
+    move-result p0
+
+    if-nez p0, :cond_0
+
+    const-string p0, "Not a GAK key"
+
+    invoke-static {p0}, Lio/mesalabs/unica/KeyStoreHooks;->dlog(Ljava/lang/String;)V
+
+    return v1
+
+    :cond_0
+    return v3
+.end method
+
+.method private static blacklist isPIFEnabled()Z
+    .locals 2
+
+    const-string v0, "persist.sys.unica.pif"
+
+    const/4 v1, 0x1
+
+    invoke-static {v0, v1}, Landroid/os/SemSystemProperties;->getBoolean(Ljava/lang/String;Z)Z
+
+    move-result v0
+
+    return v0
+.end method
+
+.method public static blacklist onGetCertificateChainHook([Ljava/security/cert/Certificate;)[Ljava/security/cert/Certificate;
+    .locals 18
+
+    const-string v0, "RSA"
+
+    invoke-static {}, Lio/mesalabs/unica/KeyStoreHooks;->isPIFEnabled()Z
+
+    move-result v1
+
+    if-nez v1, :cond_0
+
+    return-object p0
+
+    :cond_0
+    if-eqz p0, :cond_8
+
+    :try_start_0
+    invoke-static/range {p0 .. p0}, Lio/mesalabs/unica/KeyStoreHooks;->isGAK([Ljava/security/cert/Certificate;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_8
+
+    sget-object v1, Lio/mesalabs/unica/KeyStoreHooks;->sCertificateFactory:Ljava/security/cert/CertificateFactory;
+
+    new-instance v2, Ljava/io/ByteArrayInputStream;
+
+    const/4 v3, 0x0
+
+    aget-object v4, p0, v3
+
+    invoke-virtual {v4}, Ljava/security/cert/Certificate;->getEncoded()[B
+
+    move-result-object v4
+
+    invoke-direct {v2, v4}, Ljava/io/ByteArrayInputStream;-><init>([B)V
+
+    invoke-virtual {v1, v2}, Ljava/security/cert/CertificateFactory;->generateCertificate(Ljava/io/InputStream;)Ljava/security/cert/Certificate;
+
+    move-result-object v1
+
+    check-cast v1, Ljava/security/cert/X509Certificate;
+
+    sget-object v2, Lio/mesalabs/unica/KeyStoreHooks;->ASN1_OID:Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;
+
+    invoke-virtual {v2}, Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;->getId()Ljava/lang/String;
+
+    move-result-object v4
+
+    invoke-virtual {v1, v4}, Ljava/security/cert/X509Certificate;->getExtensionValue(Ljava/lang/String;)[B
+
+    move-result-object v4
+
+    if-nez v4, :cond_1
+
+    return-object p0
+
+    :cond_1
+    new-instance v4, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;
+
+    invoke-virtual {v1}, Ljava/security/cert/X509Certificate;->getEncoded()[B
+
+    move-result-object v5
+
+    invoke-direct {v4, v5}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;-><init>([B)V
+
+    invoke-virtual {v4, v2}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getExtension(Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;)Lcom/android/internal/org/bouncycastle/asn1/x509/Extension;
+
+    move-result-object v2
+
+    invoke-virtual {v2}, Lcom/android/internal/org/bouncycastle/asn1/x509/Extension;->getExtnValue()Lcom/android/internal/org/bouncycastle/asn1/ASN1OctetString;
+
+    move-result-object v2
+
+    invoke-virtual {v2}, Lcom/android/internal/org/bouncycastle/asn1/ASN1OctetString;->getOctets()[B
+
+    move-result-object v2
+
+    invoke-static {v2}, Lcom/android/internal/org/bouncycastle/asn1/ASN1Sequence;->getInstance(Ljava/lang/Object;)Lcom/android/internal/org/bouncycastle/asn1/ASN1Sequence;
+
+    move-result-object v2
+
+    invoke-virtual {v2}, Lcom/android/internal/org/bouncycastle/asn1/ASN1Sequence;->toArray()[Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;
+
+    move-result-object v2
+
+    new-instance v5, Lcom/android/internal/org/bouncycastle/asn1/ASN1EncodableVector;
+
+    invoke-direct {v5}, Lcom/android/internal/org/bouncycastle/asn1/ASN1EncodableVector;-><init>()V
+
+    const/4 v6, 0x7
+
+    aget-object v7, v2, v6
+
+    check-cast v7, Lcom/android/internal/org/bouncycastle/asn1/ASN1Sequence;
+
+    invoke-virtual {v7}, Lcom/android/internal/org/bouncycastle/asn1/ASN1Sequence;->iterator()Ljava/util/Iterator;
+
+    move-result-object v7
+
+    :goto_0
+    invoke-interface {v7}, Ljava/util/Iterator;->hasNext()Z
+
+    move-result v8
+
+    const/16 v9, 0x2c0
+
+    if-eqz v8, :cond_3
+
+    invoke-interface {v7}, Ljava/util/Iterator;->next()Ljava/lang/Object;
+
+    move-result-object v8
+
+    check-cast v8, Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;
+
+    check-cast v8, Lcom/android/internal/org/bouncycastle/asn1/ASN1TaggedObject;
+
+    invoke-virtual {v8}, Lcom/android/internal/org/bouncycastle/asn1/ASN1TaggedObject;->getTagNo()I
+
+    move-result v10
+
+    if-ne v10, v9, :cond_2
+
+    goto :goto_0
+
+    :cond_2
+    invoke-virtual {v5, v8}, Lcom/android/internal/org/bouncycastle/asn1/ASN1EncodableVector;->add(Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;)V
+
+    goto :goto_0
+
+    :cond_3
+    const-string v7, "EC"
+
+    invoke-virtual {v1}, Ljava/security/cert/X509Certificate;->getPublicKey()Ljava/security/PublicKey;
+
+    move-result-object v8
+
+    invoke-interface {v8}, Ljava/security/PublicKey;->getAlgorithm()Ljava/lang/String;
+
+    move-result-object v8
+
+    invoke-virtual {v7, v8}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v7
+
+    if-eqz v7, :cond_4
+
+    new-instance v0, Ljava/util/LinkedList;
+
+    sget-object v7, Lio/mesalabs/unica/KeyStoreHooks;->EC_CERTS:Ljava/util/List;
+
+    invoke-direct {v0, v7}, Ljava/util/LinkedList;-><init>(Ljava/util/Collection;)V
+
+    new-instance v8, Lcom/android/internal/org/bouncycastle/cert/X509v3CertificateBuilder;
+
+    new-instance v10, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;
+
+    invoke-interface {v7, v3}, Ljava/util/List;->get(I)Ljava/lang/Object;
+
+    move-result-object v7
+
+    check-cast v7, Ljava/security/cert/Certificate;
+
+    invoke-virtual {v7}, Ljava/security/cert/Certificate;->getEncoded()[B
+
+    move-result-object v7
+
+    invoke-direct {v10, v7}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;-><init>([B)V
+
+    invoke-virtual {v10}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getSubject()Lcom/android/internal/org/bouncycastle/asn1/x500/X500Name;
+
+    move-result-object v11
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getSerialNumber()Ljava/math/BigInteger;
+
+    move-result-object v12
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getNotBefore()Ljava/util/Date;
+
+    move-result-object v13
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getNotAfter()Ljava/util/Date;
+
+    move-result-object v14
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getSubject()Lcom/android/internal/org/bouncycastle/asn1/x500/X500Name;
+
+    move-result-object v15
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getSubjectPublicKeyInfo()Lcom/android/internal/org/bouncycastle/asn1/x509/SubjectPublicKeyInfo;
+
+    move-result-object v16
+
+    move-object v10, v8
+
+    invoke-direct/range {v10 .. v16}, Lcom/android/internal/org/bouncycastle/cert/X509v3CertificateBuilder;-><init>(Lcom/android/internal/org/bouncycastle/asn1/x500/X500Name;Ljava/math/BigInteger;Ljava/util/Date;Ljava/util/Date;Lcom/android/internal/org/bouncycastle/asn1/x500/X500Name;Lcom/android/internal/org/bouncycastle/asn1/x509/SubjectPublicKeyInfo;)V
+
+    new-instance v7, Lcom/android/internal/org/bouncycastle/operator/jcajce/JcaContentSignerBuilder;
+
+    invoke-virtual {v1}, Ljava/security/cert/X509Certificate;->getSigAlgName()Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-direct {v7, v1}, Lcom/android/internal/org/bouncycastle/operator/jcajce/JcaContentSignerBuilder;-><init>(Ljava/lang/String;)V
+
+    const-string v1, "ECDSA"
+
+    invoke-static {v1}, Lio/mesalabs/unica/KeyStoreHooks;->getKeyFactory(Ljava/lang/String;)Ljava/security/KeyFactory;
+
+    move-result-object v1
+
+    new-instance v10, Ljava/security/spec/PKCS8EncodedKeySpec;
+
+    sget-object v11, Lio/mesalabs/unica/KeyStoreHooks;->EC_PRIVATE_KEY:Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+
+    invoke-virtual {v11}, Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;->getEncoded()[B
+
+    move-result-object v11
+
+    invoke-direct {v10, v11}, Ljava/security/spec/PKCS8EncodedKeySpec;-><init>([B)V
+
+    invoke-virtual {v1, v10}, Ljava/security/KeyFactory;->generatePrivate(Ljava/security/spec/KeySpec;)Ljava/security/PrivateKey;
+
+    move-result-object v1
+
+    invoke-virtual {v7, v1}, Lcom/android/internal/org/bouncycastle/operator/jcajce/JcaContentSignerBuilder;->build(Ljava/security/PrivateKey;)Lcom/android/internal/org/bouncycastle/operator/ContentSigner;
+
+    move-result-object v1
+
+    goto :goto_1
+
+    :cond_4
+    invoke-virtual {v1}, Ljava/security/cert/X509Certificate;->getPublicKey()Ljava/security/PublicKey;
+
+    move-result-object v7
+
+    invoke-interface {v7}, Ljava/security/PublicKey;->getAlgorithm()Ljava/lang/String;
+
+    move-result-object v7
+
+    invoke-virtual {v0, v7}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v7
+
+    if-eqz v7, :cond_7
+
+    new-instance v7, Ljava/util/LinkedList;
+
+    sget-object v8, Lio/mesalabs/unica/KeyStoreHooks;->RSA_CERTS:Ljava/util/List;
+
+    invoke-direct {v7, v8}, Ljava/util/LinkedList;-><init>(Ljava/util/Collection;)V
+
+    new-instance v17, Lcom/android/internal/org/bouncycastle/cert/X509v3CertificateBuilder;
+
+    new-instance v10, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;
+
+    invoke-interface {v8, v3}, Ljava/util/List;->get(I)Ljava/lang/Object;
+
+    move-result-object v8
+
+    check-cast v8, Ljava/security/cert/Certificate;
+
+    invoke-virtual {v8}, Ljava/security/cert/Certificate;->getEncoded()[B
+
+    move-result-object v8
+
+    invoke-direct {v10, v8}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;-><init>([B)V
+
+    invoke-virtual {v10}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getSubject()Lcom/android/internal/org/bouncycastle/asn1/x500/X500Name;
+
+    move-result-object v11
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getSerialNumber()Ljava/math/BigInteger;
+
+    move-result-object v12
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getNotBefore()Ljava/util/Date;
+
+    move-result-object v13
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getNotAfter()Ljava/util/Date;
+
+    move-result-object v14
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getSubject()Lcom/android/internal/org/bouncycastle/asn1/x500/X500Name;
+
+    move-result-object v15
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getSubjectPublicKeyInfo()Lcom/android/internal/org/bouncycastle/asn1/x509/SubjectPublicKeyInfo;
+
+    move-result-object v16
+
+    move-object/from16 v10, v17
+
+    invoke-direct/range {v10 .. v16}, Lcom/android/internal/org/bouncycastle/cert/X509v3CertificateBuilder;-><init>(Lcom/android/internal/org/bouncycastle/asn1/x500/X500Name;Ljava/math/BigInteger;Ljava/util/Date;Ljava/util/Date;Lcom/android/internal/org/bouncycastle/asn1/x500/X500Name;Lcom/android/internal/org/bouncycastle/asn1/x509/SubjectPublicKeyInfo;)V
+
+    new-instance v8, Lcom/android/internal/org/bouncycastle/operator/jcajce/JcaContentSignerBuilder;
+
+    invoke-virtual {v1}, Ljava/security/cert/X509Certificate;->getSigAlgName()Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-direct {v8, v1}, Lcom/android/internal/org/bouncycastle/operator/jcajce/JcaContentSignerBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-static {v0}, Lio/mesalabs/unica/KeyStoreHooks;->getKeyFactory(Ljava/lang/String;)Ljava/security/KeyFactory;
+
+    move-result-object v0
+
+    new-instance v1, Ljava/security/spec/PKCS8EncodedKeySpec;
+
+    sget-object v10, Lio/mesalabs/unica/KeyStoreHooks;->RSA_PRIVATE_KEY:Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+
+    invoke-virtual {v10}, Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;->getEncoded()[B
+
+    move-result-object v10
+
+    invoke-direct {v1, v10}, Ljava/security/spec/PKCS8EncodedKeySpec;-><init>([B)V
+
+    invoke-virtual {v0, v1}, Ljava/security/KeyFactory;->generatePrivate(Ljava/security/spec/KeySpec;)Ljava/security/PrivateKey;
+
+    move-result-object v0
+
+    invoke-virtual {v8, v0}, Lcom/android/internal/org/bouncycastle/operator/jcajce/JcaContentSignerBuilder;->build(Ljava/security/PrivateKey;)Lcom/android/internal/org/bouncycastle/operator/ContentSigner;
+
+    move-result-object v1
+
+    move-object v0, v7
+
+    move-object/from16 v8, v17
+
+    :goto_1
+    const/16 v7, 0x20
+
+    new-array v10, v7, [B
+
+    new-array v7, v7, [B
+
+    invoke-static {}, Ljava/util/concurrent/ThreadLocalRandom;->current()Ljava/util/concurrent/ThreadLocalRandom;
+
+    move-result-object v11
+
+    invoke-virtual {v11, v10}, Ljava/util/concurrent/ThreadLocalRandom;->nextBytes([B)V
+
+    invoke-static {}, Ljava/util/concurrent/ThreadLocalRandom;->current()Ljava/util/concurrent/ThreadLocalRandom;
+
+    move-result-object v11
+
+    invoke-virtual {v11, v7}, Ljava/util/concurrent/ThreadLocalRandom;->nextBytes([B)V
+
+    new-instance v11, Lcom/android/internal/org/bouncycastle/asn1/DERTaggedObject;
+
+    new-instance v12, Lcom/android/internal/org/bouncycastle/asn1/DERSequence;
+
+    const/4 v13, 0x4
+
+    new-array v13, v13, [Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;
+
+    new-instance v14, Lcom/android/internal/org/bouncycastle/asn1/DEROctetString;
+
+    invoke-direct {v14, v10}, Lcom/android/internal/org/bouncycastle/asn1/DEROctetString;-><init>([B)V
+
+    aput-object v14, v13, v3
+
+    sget-object v10, Lcom/android/internal/org/bouncycastle/asn1/ASN1Boolean;->TRUE:Lcom/android/internal/org/bouncycastle/asn1/ASN1Boolean;
+
+    const/4 v14, 0x1
+
+    aput-object v10, v13, v14
+
+    new-instance v10, Lcom/android/internal/org/bouncycastle/asn1/ASN1Enumerated;
+
+    invoke-direct {v10, v3}, Lcom/android/internal/org/bouncycastle/asn1/ASN1Enumerated;-><init>(I)V
+
+    const/4 v14, 0x2
+
+    aput-object v10, v13, v14
+
+    new-instance v10, Lcom/android/internal/org/bouncycastle/asn1/DEROctetString;
+
+    invoke-direct {v10, v7}, Lcom/android/internal/org/bouncycastle/asn1/DEROctetString;-><init>([B)V
+
+    const/4 v7, 0x3
+
+    aput-object v10, v13, v7
+
+    invoke-direct {v12, v13}, Lcom/android/internal/org/bouncycastle/asn1/DERSequence;-><init>([Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;)V
+
+    invoke-direct {v11, v9, v12}, Lcom/android/internal/org/bouncycastle/asn1/DERTaggedObject;-><init>(ILcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;)V
+
+    invoke-virtual {v5, v11}, Lcom/android/internal/org/bouncycastle/asn1/ASN1EncodableVector;->add(Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;)V
+
+    new-instance v7, Lcom/android/internal/org/bouncycastle/asn1/DERSequence;
+
+    invoke-direct {v7, v5}, Lcom/android/internal/org/bouncycastle/asn1/DERSequence;-><init>(Lcom/android/internal/org/bouncycastle/asn1/ASN1EncodableVector;)V
+
+    aput-object v7, v2, v6
+
+    new-instance v5, Lcom/android/internal/org/bouncycastle/asn1/x509/Extension;
+
+    sget-object v6, Lio/mesalabs/unica/KeyStoreHooks;->ASN1_OID:Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;
+
+    new-instance v7, Lcom/android/internal/org/bouncycastle/asn1/DEROctetString;
+
+    new-instance v9, Lcom/android/internal/org/bouncycastle/asn1/DERSequence;
+
+    invoke-direct {v9, v2}, Lcom/android/internal/org/bouncycastle/asn1/DERSequence;-><init>([Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;)V
+
+    invoke-direct {v7, v9}, Lcom/android/internal/org/bouncycastle/asn1/DEROctetString;-><init>(Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;)V
+
+    invoke-direct {v5, v6, v3, v7}, Lcom/android/internal/org/bouncycastle/asn1/x509/Extension;-><init>(Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;ZLcom/android/internal/org/bouncycastle/asn1/ASN1OctetString;)V
+
+    invoke-virtual {v8, v5}, Lcom/android/internal/org/bouncycastle/cert/X509v3CertificateBuilder;->addExtension(Lcom/android/internal/org/bouncycastle/asn1/x509/Extension;)Lcom/android/internal/org/bouncycastle/cert/X509v3CertificateBuilder;
+
+    invoke-virtual {v4}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getExtensions()Lcom/android/internal/org/bouncycastle/asn1/x509/Extensions;
+
+    move-result-object v2
+
+    invoke-virtual {v2}, Lcom/android/internal/org/bouncycastle/asn1/x509/Extensions;->getExtensionOIDs()[Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;
+
+    move-result-object v2
+
+    array-length v5, v2
+
+    move v6, v3
+
+    :goto_2
+    if-ge v6, v5, :cond_6
+
+    aget-object v7, v2, v6
+
+    sget-object v9, Lio/mesalabs/unica/KeyStoreHooks;->ASN1_OID:Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;
+
+    invoke-virtual {v9}, Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;->getId()Ljava/lang/String;
+
+    move-result-object v9
+
+    invoke-virtual {v7}, Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;->getId()Ljava/lang/String;
+
+    move-result-object v10
+
+    invoke-virtual {v9, v10}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v9
+
+    if-eqz v9, :cond_5
+
+    goto :goto_3
+
+    :cond_5
+    invoke-virtual {v4, v7}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getExtension(Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;)Lcom/android/internal/org/bouncycastle/asn1/x509/Extension;
+
+    move-result-object v7
+
+    invoke-virtual {v8, v7}, Lcom/android/internal/org/bouncycastle/cert/X509v3CertificateBuilder;->addExtension(Lcom/android/internal/org/bouncycastle/asn1/x509/Extension;)Lcom/android/internal/org/bouncycastle/cert/X509v3CertificateBuilder;
+
+    :goto_3
+    add-int/lit8 v6, v6, 0x1
+
+    goto :goto_2
+
+    :cond_6
+    sget-object v2, Lio/mesalabs/unica/KeyStoreHooks;->sCertificateFactory:Ljava/security/cert/CertificateFactory;
+
+    new-instance v4, Ljava/io/ByteArrayInputStream;
+
+    invoke-virtual {v8, v1}, Lcom/android/internal/org/bouncycastle/cert/X509v3CertificateBuilder;->build(Lcom/android/internal/org/bouncycastle/operator/ContentSigner;)Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;
+
+    move-result-object v1
+
+    invoke-virtual {v1}, Lcom/android/internal/org/bouncycastle/cert/X509CertificateHolder;->getEncoded()[B
+
+    move-result-object v1
+
+    invoke-direct {v4, v1}, Ljava/io/ByteArrayInputStream;-><init>([B)V
+
+    invoke-virtual {v2, v4}, Ljava/security/cert/CertificateFactory;->generateCertificate(Ljava/io/InputStream;)Ljava/security/cert/Certificate;
+
+    move-result-object v1
+
+    invoke-virtual {v0, v1}, Ljava/util/LinkedList;->addFirst(Ljava/lang/Object;)V
+
+    new-array v1, v3, [Ljava/security/cert/Certificate;
+
+    invoke-virtual {v0, v1}, Ljava/util/LinkedList;->toArray([Ljava/lang/Object;)[Ljava/lang/Object;
+
+    move-result-object v0
+
+    check-cast v0, [Ljava/security/cert/Certificate;
+
+    return-object v0
+
+    :cond_7
+    new-instance v0, Ljava/lang/UnsupportedOperationException;
+
+    new-instance v2, Ljava/lang/StringBuilder;
+
+    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v3, "unsupported algorithm "
+
+    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v2
+
+    invoke-virtual {v1}, Ljava/security/cert/X509Certificate;->getPublicKey()Ljava/security/PublicKey;
+
+    move-result-object v1
+
+    invoke-interface {v1}, Ljava/security/PublicKey;->getAlgorithm()Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-virtual {v2, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v1
+
+    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-direct {v0, v1}, Ljava/lang/UnsupportedOperationException;-><init>(Ljava/lang/String;)V
+
+    throw v0
+    :try_end_0
+    .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_0} :catch_0
+
+    :catch_0
+    move-exception v0
+
+    invoke-virtual {v0}, Ljava/lang/Exception;->toString()Ljava/lang/String;
+
+    move-result-object v0
+
+    invoke-static {v0}, Lio/mesalabs/unica/KeyStoreHooks;->dlog(Ljava/lang/String;)V
+
+    :cond_8
+    return-object p0
+.end method
+
+.method public static blacklist onHasSystemFeatureHook(Ljava/lang/String;)Ljava/lang/Boolean;
+    .locals 3
+
+    invoke-static {}, Lio/mesalabs/unica/KeyStoreHooks;->isPIFEnabled()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_1
+
+    const-string v0, "android.hardware.keystore.app_attest_key"
+
+    invoke-virtual {v0, p0}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v0
+
+    if-nez v0, :cond_0
+
+    const-string v0, "android.hardware.strongbox_keystore"
+
+    invoke-virtual {v0, p0}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_1
+
+    :cond_0
+    sget-object v0, Ljava/lang/Boolean;->FALSE:Ljava/lang/Boolean;
+
+    goto :goto_0
+
+    :cond_1
+    const/4 v0, 0x0
+
+    :goto_0
+    if-eqz v0, :cond_2
+
+    new-instance v1, Ljava/lang/StringBuilder;
+
+    const-string v2, "Spoofing \""
+
+    invoke-direct {v1, v2}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-virtual {v1, p0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object p0
+
+    const-string v1, "\" feature to \""
+
+    invoke-virtual {p0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object p0
+
+    invoke-virtual {p0, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+
+    move-result-object p0
+
+    const-string v1, "\""
+
+    invoke-virtual {p0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object p0
+
+    invoke-virtual {p0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object p0
+
+    invoke-static {p0}, Lio/mesalabs/unica/KeyStoreHooks;->dlog(Ljava/lang/String;)V
+
+    :cond_2
+    return-object v0
+.end method
+
+.method private static blacklist parseCert(Ljava/lang/String;)Ljava/security/cert/Certificate;
+    .locals 2
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/lang/Exception;
+        }
+    .end annotation
+
+    new-instance v0, Lcom/android/internal/org/bouncycastle/util/io/pem/PemReader;
+
+    new-instance v1, Ljava/io/StringReader;
+
+    invoke-direct {v1, p0}, Ljava/io/StringReader;-><init>(Ljava/lang/String;)V
+
+    invoke-direct {v0, v1}, Lcom/android/internal/org/bouncycastle/util/io/pem/PemReader;-><init>(Ljava/io/Reader;)V
+
+    sget-object p0, Lio/mesalabs/unica/KeyStoreHooks;->sCertificateFactory:Ljava/security/cert/CertificateFactory;
+
+    new-instance v1, Ljava/io/ByteArrayInputStream;
+
+    invoke-virtual {v0}, Lcom/android/internal/org/bouncycastle/util/io/pem/PemReader;->readPemObject()Lcom/android/internal/org/bouncycastle/util/io/pem/PemObject;
+
+    move-result-object v0
+
+    invoke-virtual {v0}, Lcom/android/internal/org/bouncycastle/util/io/pem/PemObject;->getContent()[B
+
+    move-result-object v0
+
+    invoke-direct {v1, v0}, Ljava/io/ByteArrayInputStream;-><init>([B)V
+
+    invoke-virtual {p0, v1}, Ljava/security/cert/CertificateFactory;->generateCertificate(Ljava/io/InputStream;)Ljava/security/cert/Certificate;
+
+    move-result-object p0
+
+    return-object p0
+.end method
+
+.method private static blacklist parsePrivateKey(Ljava/lang/String;Z)Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+    .locals 2
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Ljava/lang/Exception;
+        }
+    .end annotation
+
+    new-instance v0, Lcom/android/internal/org/bouncycastle/util/io/pem/PemReader;
+
+    new-instance v1, Ljava/io/StringReader;
+
+    invoke-direct {v1, p0}, Ljava/io/StringReader;-><init>(Ljava/lang/String;)V
+
+    invoke-direct {v0, v1}, Lcom/android/internal/org/bouncycastle/util/io/pem/PemReader;-><init>(Ljava/io/Reader;)V
+
+    invoke-virtual {v0}, Lcom/android/internal/org/bouncycastle/util/io/pem/PemReader;->readPemObject()Lcom/android/internal/org/bouncycastle/util/io/pem/PemObject;
+
+    move-result-object p0
+
+    invoke-virtual {p0}, Lcom/android/internal/org/bouncycastle/util/io/pem/PemObject;->getContent()[B
+
+    move-result-object p0
+
+    invoke-static {p0}, Lcom/android/internal/org/bouncycastle/asn1/ASN1Sequence;->getInstance(Ljava/lang/Object;)Lcom/android/internal/org/bouncycastle/asn1/ASN1Sequence;
+
+    move-result-object p0
+
+    if-eqz p1, :cond_0
+
+    invoke-static {p0}, Lcom/android/internal/org/bouncycastle/asn1/sec/ECPrivateKey;->getInstance(Ljava/lang/Object;)Lcom/android/internal/org/bouncycastle/asn1/sec/ECPrivateKey;
+
+    move-result-object p0
+
+    new-instance p1, Lcom/android/internal/org/bouncycastle/asn1/x509/AlgorithmIdentifier;
+
+    sget-object v0, Lcom/android/internal/org/bouncycastle/asn1/x9/X9ObjectIdentifiers;->id_ecPublicKey:Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;
+
+    invoke-virtual {p0}, Lcom/android/internal/org/bouncycastle/asn1/sec/ECPrivateKey;->getParameters()Lcom/android/internal/org/bouncycastle/asn1/ASN1Primitive;
+
+    move-result-object v1
+
+    invoke-direct {p1, v0, v1}, Lcom/android/internal/org/bouncycastle/asn1/x509/AlgorithmIdentifier;-><init>(Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;)V
+
+    new-instance v0, Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+
+    invoke-direct {v0, p1, p0}, Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;-><init>(Lcom/android/internal/org/bouncycastle/asn1/x509/AlgorithmIdentifier;Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;)V
+
+    return-object v0
+
+    :cond_0
+    invoke-static {p0}, Lcom/android/internal/org/bouncycastle/asn1/pkcs/RSAPrivateKey;->getInstance(Ljava/lang/Object;)Lcom/android/internal/org/bouncycastle/asn1/pkcs/RSAPrivateKey;
+
+    move-result-object p1
+
+    invoke-virtual {p0}, Lcom/android/internal/org/bouncycastle/asn1/ASN1Sequence;->size()I
+
+    move-result p0
+
+    const/16 v0, 0x9
+
+    if-ne p0, v0, :cond_1
+
+    new-instance p0, Lcom/android/internal/org/bouncycastle/asn1/x509/AlgorithmIdentifier;
+
+    sget-object v0, Lcom/android/internal/org/bouncycastle/asn1/pkcs/PKCSObjectIdentifiers;->rsaEncryption:Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;
+
+    sget-object v1, Lcom/android/internal/org/bouncycastle/asn1/DERNull;->INSTANCE:Lcom/android/internal/org/bouncycastle/asn1/DERNull;
+
+    invoke-direct {p0, v0, v1}, Lcom/android/internal/org/bouncycastle/asn1/x509/AlgorithmIdentifier;-><init>(Lcom/android/internal/org/bouncycastle/asn1/ASN1ObjectIdentifier;Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;)V
+
+    new-instance v0, Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;
+
+    invoke-direct {v0, p0, p1}, Lcom/android/internal/org/bouncycastle/asn1/pkcs/PrivateKeyInfo;-><init>(Lcom/android/internal/org/bouncycastle/asn1/x509/AlgorithmIdentifier;Lcom/android/internal/org/bouncycastle/asn1/ASN1Encodable;)V
+
+    return-object v0
+
+    :cond_1
+    new-instance p0, Ljava/lang/Exception;
+
+    const-string p1, "malformed sequence in RSA private key"
+
+    invoke-direct {p0, p1}, Ljava/lang/Exception;-><init>(Ljava/lang/String;)V
+
+    throw p0
+.end method
-- 
2.46.0

