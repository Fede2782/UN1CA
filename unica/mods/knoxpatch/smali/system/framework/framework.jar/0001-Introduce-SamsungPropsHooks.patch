From 6456d454b47c7b7e687aa0572e5732298525198f Mon Sep 17 00:00:00 2001
From: BlackMesa123 <giangrecosalvo9@gmail.com>
Date: Wed, 12 Jun 2024 16:46:34 +0200
Subject: [PATCH] Introduce SamsungPropsHooks

---
 smali/android/app/Instrumentation.smali       |   4 +
 .../android/os/SystemProperties.smali         |  14 +
 .../io/mesalabs/unica/SamsungPropsHooks.smali | 518 ++++++++++++++++++
 3 files changed, 536 insertions(+)
 create mode 100644 smali_classes6/io/mesalabs/unica/SamsungPropsHooks.smali

diff --git a/smali/android/app/Instrumentation.smali b/smali/android/app/Instrumentation.smali
index 86460ff3..fd6534b0 100644
--- a/smali/android/app/Instrumentation.smali
+++ b/smali/android/app/Instrumentation.smali
@@ -632,6 +632,8 @@
 
     invoke-virtual {v0, p1}, Landroid/app/Application;->attach(Landroid/content/Context;)V
 
+    invoke-static {p1}, Lio/mesalabs/unica/SamsungPropsHooks;->init(Landroid/content/Context;)V
+
     return-object v0
 .end method
 
@@ -3842,6 +3844,8 @@
 
     invoke-virtual {v0, p3}, Landroid/app/Application;->attach(Landroid/content/Context;)V
 
+    invoke-static {p3}, Lio/mesalabs/unica/SamsungPropsHooks;->init(Landroid/content/Context;)V
+
     return-object v0
 .end method
 
diff --git a/smali_classes3/android/os/SystemProperties.smali b/smali_classes3/android/os/SystemProperties.smali
index 25fa7c61..5ea40e7f 100644
--- a/smali_classes3/android/os/SystemProperties.smali
+++ b/smali_classes3/android/os/SystemProperties.smali
@@ -367,10 +367,17 @@
     .annotation runtime Landroid/annotation/SystemApi;
     .end annotation
 
+    invoke-static {p0}, Lio/mesalabs/unica/SamsungPropsHooks;->onSPGetHook(Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v0
+
+    if-nez v0, :cond_0
+
     invoke-static {p0}, Landroid/os/SystemProperties;->native_get(Ljava/lang/String;)Ljava/lang/String;
 
     move-result-object v0
 
+    :cond_0
     return-object v0
 .end method
 
@@ -379,10 +386,17 @@
     .annotation runtime Landroid/annotation/SystemApi;
     .end annotation
 
+    invoke-static {p0}, Lio/mesalabs/unica/SamsungPropsHooks;->onSPGetHook(Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v0
+
+    if-nez v0, :cond_0
+
     invoke-static {p0, p1}, Landroid/os/SystemProperties;->native_get(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
 
     move-result-object v0
 
+    :cond_0
     return-object v0
 .end method
 
diff --git a/smali_classes6/io/mesalabs/unica/SamsungPropsHooks.smali b/smali_classes6/io/mesalabs/unica/SamsungPropsHooks.smali
new file mode 100644
index 00000000..cc44bfe5
--- /dev/null
+++ b/smali_classes6/io/mesalabs/unica/SamsungPropsHooks.smali
@@ -0,0 +1,518 @@
+.class public Lio/mesalabs/unica/SamsungPropsHooks;
+.super Ljava/lang/Object;
+.source "SamsungPropsHooks.java"
+
+
+# static fields
+.field private static final blacklist AUTO_BLOCKER_PACKAGE_NAME:Ljava/lang/String; = "com.samsung.android.rampart"
+
+.field private static final blacklist DEBUG:Z = false
+
+.field private static final blacklist FM_RADIO_PACKAGE_NAME:Ljava/lang/String; = "com.sec.android.app.fm"
+
+.field private static final blacklist SAMSUNG_HEALTH_PACKAGE_NAME:Ljava/lang/String; = "com.sec.android.app.shealth"
+
+.field private static final blacklist SECURE_WIFI_PACKAGE_NAME:Ljava/lang/String; = "com.samsung.android.fast"
+
+.field private static final blacklist SMART_SUGGESTIONS_PACKAGE_NAME:Ljava/lang/String; = "com.samsung.android.smartsuggestions"
+
+.field private static final blacklist SMART_VIEW_PACKAGE_NAME:Ljava/lang/String; = "com.samsung.android.smartmirroring"
+
+.field private static final blacklist TAG:Ljava/lang/String; = "SamsungPropsHooks"
+
+.field private static volatile blacklist sPackageName:Ljava/lang/String;
+
+.field private static volatile blacklist sSpoofBuildType:Z
+
+.field private static volatile blacklist sSpoofDeviceToA525G:Z
+
+.field private static volatile blacklist sSpoofKeystore:Z
+
+.field private static volatile blacklist sSpoofKnox:Z
+
+.field private static volatile blacklist sSpoofProps:Z
+
+.field private static volatile blacklist sSpoofVendorDevice:Z
+
+.field private static final blacklist sTargetPackages:[Ljava/lang/String;
+
+
+# direct methods
+.method static constructor blacklist <clinit>()V
+    .locals 3
+
+    const/4 v0, 0x4
+
+    new-array v0, v0, [Ljava/lang/String;
+
+    const/4 v1, 0x0
+
+    const-string v2, "com.samsung.android.rampart"
+
+    aput-object v2, v0, v1
+
+    const/4 v1, 0x1
+
+    const-string v2, "com.sec.android.app.shealth"
+
+    aput-object v2, v0, v1
+
+    const/4 v1, 0x2
+
+    const-string v2, "com.samsung.android.fast"
+
+    aput-object v2, v0, v1
+
+    const/4 v1, 0x3
+
+    const-string v2, "com.samsung.android.smartsuggestions"
+
+    aput-object v2, v0, v1
+
+    sput-object v0, Lio/mesalabs/unica/SamsungPropsHooks;->sTargetPackages:[Ljava/lang/String;
+
+    return-void
+.end method
+
+.method private constructor blacklist <init>()V
+    .locals 0
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
+
+.method public static blacklist dlog(Ljava/lang/String;)V
+    .locals 0
+
+    return-void
+.end method
+
+.method public static blacklist init(Landroid/content/Context;)V
+    .locals 5
+
+    invoke-virtual {p0}, Landroid/content/Context;->getPackageName()Ljava/lang/String;
+
+    move-result-object v0
+
+    if-eqz v0, :cond_4
+
+    invoke-virtual {v0}, Ljava/lang/String;->isEmpty()Z
+
+    move-result v1
+
+    if-eqz v1, :cond_0
+
+    goto/16 :goto_2
+
+    :cond_0
+    sput-object v0, Lio/mesalabs/unica/SamsungPropsHooks;->sPackageName:Ljava/lang/String;
+
+    const-string v1, "com.samsung.android.smartmirroring"
+
+    invoke-virtual {v0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    sput-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofBuildType:Z
+
+    const-string v1, "com.sec.android.app.fm"
+
+    invoke-virtual {v0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    sput-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofDeviceToA525G:Z
+
+    sget-object v1, Lio/mesalabs/unica/SamsungPropsHooks;->sTargetPackages:[Ljava/lang/String;
+
+    invoke-static {v1}, Ljava/util/Arrays;->asList([Ljava/lang/Object;)Ljava/util/List;
+
+    move-result-object v1
+
+    invoke-interface {v1, v0}, Ljava/util/List;->contains(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    sput-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofProps:Z
+
+    const-string v1, "com.sec.android.app.shealth"
+
+    invoke-virtual {v0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    sput-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofKeystore:Z
+
+    const-string v1, "com.samsung.android.smartsuggestions"
+
+    invoke-virtual {v0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    sput-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofVendorDevice:Z
+
+    const/4 v1, 0x0
+
+    :try_start_0
+    invoke-virtual {p0}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;
+
+    move-result-object v2
+
+    const-wide/16 v3, 0x80
+
+    invoke-static {v3, v4}, Landroid/content/pm/PackageManager$ApplicationInfoFlags;->of(J)Landroid/content/pm/PackageManager$ApplicationInfoFlags;
+
+    move-result-object v3
+
+    invoke-virtual {v2, v0, v3}, Landroid/content/pm/PackageManager;->getApplicationInfo(Ljava/lang/String;Landroid/content/pm/PackageManager$ApplicationInfoFlags;)Landroid/content/pm/ApplicationInfo;
+
+    move-result-object v2
+
+    const/16 v3, 0x81
+
+    iget v4, v2, Landroid/content/pm/ApplicationInfo;->flags:I
+
+    and-int/lit16 v4, v4, 0x81
+
+    if-nez v4, :cond_1
+
+    const/4 v4, 0x1
+
+    goto :goto_0
+
+    :cond_1
+    move v4, v1
+
+    :goto_0
+    sput-boolean v4, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofKnox:Z
+    :try_end_0
+    .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_0} :catch_0
+
+    goto :goto_1
+
+    :catch_0
+    move-exception v2
+
+    new-instance v3, Ljava/lang/StringBuilder;
+
+    invoke-direct {v3}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v4, "sSpoofKnox = false; "
+
+    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v3
+
+    invoke-virtual {v2}, Ljava/lang/Object;->getClass()Ljava/lang/Class;
+
+    move-result-object v4
+
+    invoke-virtual {v4}, Ljava/lang/Class;->getName()Ljava/lang/String;
+
+    move-result-object v4
+
+    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v3
+
+    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v3
+
+    invoke-static {v3}, Lio/mesalabs/unica/SamsungPropsHooks;->dlog(Ljava/lang/String;)V
+
+    sput-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofKnox:Z
+
+    :goto_1
+    sget-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofBuildType:Z
+
+    if-eqz v1, :cond_2
+
+    const-string v1, "TYPE"
+
+    const-string v2, "userdebug"
+
+    invoke-static {v1, v2}, Lio/mesalabs/unica/SamsungPropsHooks;->setBuildField(Ljava/lang/String;Ljava/lang/String;)V
+
+    :cond_2
+    sget-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofDeviceToA525G:Z
+
+    if-eqz v1, :cond_3
+
+    const-string v1, "MODEL"
+
+    const-string v2, "SM-A526B"
+
+    invoke-static {v1, v2}, Lio/mesalabs/unica/SamsungPropsHooks;->setBuildField(Ljava/lang/String;Ljava/lang/String;)V
+
+    :cond_3
+    return-void
+
+    :cond_4
+    :goto_2
+    return-void
+.end method
+
+.method public static blacklist onEDMGetAPILevelHook()I
+    .locals 1
+
+    sget-boolean v0, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofKnox:Z
+
+    if-nez v0, :cond_0
+
+    const-string v0, "37"
+
+    invoke-static {v0}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+
+    move-result v0
+
+    return v0
+
+    :cond_0
+    const/4 v0, -0x1
+
+    return v0
+.end method
+
+.method public static blacklist onSPGetHook(Ljava/lang/String;)Ljava/lang/String;
+    .locals 3
+
+    const/4 v0, 0x0
+
+    sget-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofProps:Z
+
+    if-eqz v1, :cond_1
+
+    invoke-virtual {p0}, Ljava/lang/String;->hashCode()I
+
+    move-result v1
+
+    sparse-switch v1, :sswitch_data_0
+
+    :cond_0
+    goto :goto_0
+
+    :sswitch_0
+    const-string v1, "ro.boot.warranty_bit"
+
+    invoke-virtual {p0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_0
+
+    const/4 v1, 0x2
+
+    goto :goto_1
+
+    :sswitch_1
+    const-string v1, "ro.boot.verifiedbootstate"
+
+    invoke-virtual {p0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_0
+
+    const/4 v1, 0x1
+
+    goto :goto_1
+
+    :sswitch_2
+    const-string v1, "ro.security.keystore.keytype"
+
+    invoke-virtual {p0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_0
+
+    const/4 v1, 0x3
+
+    goto :goto_1
+
+    :sswitch_3
+    const-string v1, "ro.boot.flash.locked"
+
+    invoke-virtual {p0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_0
+
+    const/4 v1, 0x0
+
+    goto :goto_1
+
+    :sswitch_4
+    const-string v1, "ro.product.vendor.device"
+
+    invoke-virtual {p0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_0
+
+    const/4 v1, 0x4
+
+    goto :goto_1
+
+    :goto_0
+    const/4 v1, -0x1
+
+    :goto_1
+    packed-switch v1, :pswitch_data_0
+
+    goto :goto_2
+
+    :pswitch_0
+    sget-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofVendorDevice:Z
+
+    if-eqz v1, :cond_1
+
+    const-string v0, "dm1q"
+
+    goto :goto_2
+
+    :pswitch_1
+    sget-boolean v1, Lio/mesalabs/unica/SamsungPropsHooks;->sSpoofKeystore:Z
+
+    if-eqz v1, :cond_1
+
+    const-string v0, ""
+
+    goto :goto_2
+
+    :pswitch_2
+    const-string v0, "0"
+
+    goto :goto_2
+
+    :pswitch_3
+    const-string v0, "green"
+
+    goto :goto_2
+
+    :pswitch_4
+    const-string v0, "1"
+
+    nop
+
+    :cond_1
+    :goto_2
+    if-eqz v0, :cond_2
+
+    new-instance v1, Ljava/lang/StringBuilder;
+
+    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v2, "Spoofing \""
+
+    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v1
+
+    invoke-virtual {v1, p0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v1
+
+    const-string v2, "\" to \""
+
+    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v1
+
+    invoke-virtual {v1, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v1
+
+    const-string v2, "\""
+
+    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v1
+
+    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-static {v1}, Lio/mesalabs/unica/SamsungPropsHooks;->dlog(Ljava/lang/String;)V
+
+    :cond_2
+    return-object v0
+
+    :sswitch_data_0
+    .sparse-switch
+        -0x4c6e0df4 -> :sswitch_4
+        -0x21fa12d -> :sswitch_3
+        0xc90c28a -> :sswitch_2
+        0x17db1dec -> :sswitch_1
+        0x300d1355 -> :sswitch_0
+    .end sparse-switch
+
+    :pswitch_data_0
+    .packed-switch 0x0
+        :pswitch_4
+        :pswitch_3
+        :pswitch_2
+        :pswitch_1
+        :pswitch_0
+    .end packed-switch
+.end method
+
+.method private static blacklist setBuildField(Ljava/lang/String;Ljava/lang/String;)V
+    .locals 3
+
+    :try_start_0
+    const-class v0, Landroid/os/Build;
+
+    invoke-virtual {v0, p0}, Ljava/lang/Class;->getDeclaredField(Ljava/lang/String;)Ljava/lang/reflect/Field;
+
+    move-result-object v0
+
+    const/4 v1, 0x1
+
+    invoke-virtual {v0, v1}, Ljava/lang/reflect/Field;->setAccessible(Z)V
+
+    const/4 v1, 0x0
+
+    invoke-virtual {v0, v1, p1}, Ljava/lang/reflect/Field;->set(Ljava/lang/Object;Ljava/lang/Object;)V
+
+    const/4 v1, 0x0
+
+    invoke-virtual {v0, v1}, Ljava/lang/reflect/Field;->setAccessible(Z)V
+    :try_end_0
+    .catch Ljava/lang/NoSuchFieldException; {:try_start_0 .. :try_end_0} :catch_0
+    .catch Ljava/lang/IllegalAccessException; {:try_start_0 .. :try_end_0} :catch_0
+
+    goto :goto_0
+
+    :catch_0
+    move-exception v0
+
+    new-instance v1, Ljava/lang/StringBuilder;
+
+    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v2, "Failed to spoof Build."
+
+    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v1
+
+    invoke-virtual {v1, p0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v1
+
+    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v1
+
+    const-string v2, "SamsungPropsHooks"
+
+    invoke-static {v2, v1, v0}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
+
+    :goto_0
+    return-void
+.end method
-- 
2.45.2

